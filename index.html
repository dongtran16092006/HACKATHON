<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kh√°m ph√° ƒë·ªãa ƒëi·ªÉm g·∫ßn b·∫°n</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: 'Montserrat', sans-serif;
      background: #f0f0f0;
      animation: lightPulse 10s ease-in-out infinite;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      gap: 20px; /* üëà Th√™m d√≤ng n√†y */
    }

    body.dark-mode {
      background: #1a1a1a;
      animation: darkPulse 10s ease-in-out infinite;
      color: white;
    }

    body.transitioning {
      filter: blur(3px);
    }

    @keyframes lightPulse {
      0%   { background-color: #f0f0f0; }
      50%  { background-color: #e0e0e0; }
      100% { background-color: #f0f0f0; }
    }

    @keyframes darkPulse {
      0%   { background-color: #1a1a1a; }
      50%  { background-color: #2c2c2c; }
      100% { background-color: #1a1a1a; }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    #darkmode-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10001;
      padding: 8px 12px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 18px;
    }

    #question-box, #profile-box, #location-info, #map {
  width: 100%;
  max-width: 600px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
  padding: 20px;
  animation: fadeInUp 0.6s ease;
}
.section-box {
  width: 100%;
  max-width: 600px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
  padding: 20px;
  animation: fadeInUp 0.6s ease;
  border: 2px solid #ccc;
}
#event-board {
  width: 100%;
  max-width: 600px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
}


    body.dark-mode #question-box,
    body.dark-mode #profile-box,
    body.dark-mode #location-info,
    body.dark-mode #map {
      background: #2c2c2c;
      color: white;
    }

    #map {
      height: 400px;
      border-radius: 16px;
      overflow: hidden;
    }

    .choices {
      width: 100% !important;
      position: relative;
      z-index: 1;
      margin-bottom: 12px;
    }

    .choices.is-open {
      z-index: 9999 !important;
    }

    .choices__inner {
      padding: 10px 12px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 10px !important;
      min-height: 42px;
      background: white;
      color: black;
    }

    body.dark-mode .choices__inner {
      background: #444;
      color: white;
      border-color: #777;
    }

    .choices__list--dropdown, .choices__list[aria-expanded] {
      width: 100% !important;
      left: 0 !important;
      top: 100% !important;
      position: absolute !important;
      border-radius: 10px !important;
      font-size: 14px;
      padding: 5px 0;
      background: white;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      z-index: 10000 !important;
      max-height: 200px;
      overflow-y: auto;
      color: black;
    }

    .choices__list--dropdown .choices__item {
      padding: 8px 12px;
      border-radius: 6px;
      transition: background 0.2s;
    }

    .choices__list--dropdown .choices__item:hover {
      background-color: #f0f0f0;
    }

    body.dark-mode .choices__list--dropdown {
      background: #333;
      color: white;
      border: 1px solid #555;
    }

    body.dark-mode .choices__list--dropdown .choices__item {
      color: white;
    }

    body.dark-mode .choices__list--dropdown .choices__item:hover {
      background-color: #555;
    }

    body.dark-mode .choices__item--selectable.is-highlighted {
      background-color: #555 !important;
      color: white !important;
    }

    body.dark-mode .choices__item--selectable[data-value][aria-selected="true"] {
      background-color: #444 !important;
      color: white !important;
    }

    button {
      padding: 10px 16px;
      border-radius: 10px;
      font-size: 15px;
      margin-top: 12px;
      border: 1px solid #ccc;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    button:hover {
      background-color: #007bff;
      color: white;
    }

    body.dark-mode button {
      background: #444;
      color: white;
      border: 1px solid #666;
    }

    body.dark-mode button:hover {
      background-color: #0056b3;
    }

    #back-button {
      background: #f44336;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 15px;
      border-radius: 12px;
      cursor: pointer;
    }

    body.dark-mode #back-button {
      background: #aa2e25;
    }

    body.dark-mode #back-button:hover {
      background: #c0392b;
    }

    ul#places-list li {
      background: #f5faff;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 10px;
    }

    body.dark-mode ul#places-list li {
      background: #3a3a3a;
    }

    a {
      color: #007bff;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    body.dark-mode a {
      color: #66bfff;
    }

    body.dark-mode a:hover {
      color: #99ccff;
    }

    /* ‚úÖ Dark mode: h·ªôp ch·ªâ ƒë∆∞·ªùng */
    body.dark-mode .leaflet-routing-container {
      background-color: #2c2c2c !important;
      color: #ffffff !important;
      border: 1px solid #555 !important;
      border-radius: 12px !important;
    }

    body.dark-mode .leaflet-routing-container a {
      color: #90caf9 !important;
    }

    body.dark-mode .leaflet-routing-alt,
    body.dark-mode .leaflet-routing-alt h2,
    body.dark-mode .leaflet-routing-alt h3,
    body.dark-mode .leaflet-routing-alt span {
      background-color: transparent !important;
      color: #ddd !important;
    }

    body.dark-mode .leaflet-routing-container .leaflet-routing-icon {
      filter: invert(1);
    }

    body.dark-mode .leaflet-routing-container li:hover,
    body.dark-mode .leaflet-routing-container tr:hover {
      background-color: #3c3c3c !important;
      color: #ffffff !important;
    }

    body.dark-mode .leaflet-routing-container .leaflet-routing-instruction:hover {
      background-color: #444 !important;
      color: #fff !important;
    }

    /* ‚úÖ Font cho label */
    label {
      font-family: 'Montserrat', 'Noto Color Emoji', sans-serif;
      font-size: 16px;
      font-weight: 700;
      color: inherit;
      display: block;
      margin-bottom: 8px;
    }
    body.dark-mode #radius-description p {
    color: #ddd;
    opacity: 0.95;
  }
  #event-board {
  width: 100%;
  max-width: 600px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  padding: 20px;
  margin-top: 20px;
  animation: fadeInUp 0.6s ease;
}
body.dark-mode #event-board {
  background: #2c2c2c;
  color: white;
}
#event-board ul {
  list-style: none;
  padding-left: 0;
}
#event-board li {
  margin-bottom: 12px;
  padding: 10px;
  background: #f9f9f9;
  border-radius: 10px;
}
body.dark-mode #event-board li {
  background: #3a3a3a;
}
.favorite-btn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  margin-left: 8px;
  color: #e74c3c;
  transition: transform 0.2s ease;
}
.favorite-btn:hover {
  transform: scale(1.2);
}
.favorite-btn.saved {
  color: #e74c3c;
}
body.dark-mode #favorites-box {
  background: #2c2c2c;
  color: white;
}

body.dark-mode #favorites-box li {
  background: #3a3a3a;
  color: white;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 10px;
}

body.dark-mode #favorites-box button {
  background: #444;
  color: white;
  border: 1px solid #666;
}

body.dark-mode #favorites-box button:hover {
  background: #0056b3;
}
body.dark-mode .section-box {
  background: #1e1e1e;
  color: white;
}
.section-box {
  width: 100%;
  max-width: 600px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
  padding: 20px;
  margin-bottom: 20px;
  animation: fadeInUp 0.6s ease;
  border: 2px solid #ccc;
}

/* Dark mode */
body.dark-mode .section-box {
  background: #2c2c2c;  /* üîÑ ƒê·ªïi t·ª´ #1e1e1e ‚Üí #2c2c2c cho ƒë·ªìng b·ªô */
  color: white;
  border: 2px solid #444;
  box-shadow: 0 6px 20px rgba(255, 255, 255, 0.05); /* ‚úÖ th√™m b√≥ng nh·∫π cho chi·ªÅu s√¢u */
}
#favorites-box {
  opacity: 0;
  transform: translateY(30px);
  transition: all 0.4s ease;
  pointer-events: none;
  display: none;
}

#favorites-box.active {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
  display: block !important;
}
#favorites-box {
  opacity: 0;
  transform: translateY(30px);
  transition: all 0.2s ease;
  pointer-events: none;
  max-height: 0;
  overflow: hidden;
}

#favorites-box.active {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
  max-height: 500px; /* ƒë·ªß ƒë·ªÉ ch·ª©a n·ªôi dung */
}
/* üîÅ C·∫£nh b√°o xoay ngang cho thi·∫øt b·ªã di ƒë·ªông */
.mobile-warning {
  text-align: center;
  color: #c0392b;
  font-weight: bold;
  display: none;
  margin-bottom: 10px;
}

@media screen and (max-width: 768px) and (orientation: portrait) {
  .mobile-warning {
    display: block;
  }
}

  </style>
</head>
<body>
  <!-- ƒêƒÉng nh·∫≠p t√πy ch·ªçn -->
  <div id="auth-box" style="margin-bottom: 20px;">
    <button id="login-btn" onclick="login()">üîê ƒêƒÉng nh·∫≠p b·∫±ng Google</button>
  <div id="user-info" style="display: none;">
    <p id="user-name"></p>
    <button onclick="logout()">üö™ ƒêƒÉng xu·∫•t</button>
  </div>
</div>
  <button id="darkmode-toggle" onclick="toggleDarkMode()">üåô</button>
  <div id="question-box">
    <h2>B·∫°n mu·ªën tham quan lo·∫°i ƒë·ªãa ƒëi·ªÉm n√†o?</h2>
    <select id="category">
      <option value="culture">VƒÉn h√≥a</option>
      <option value="history">L·ªãch s·ª≠</option>
      <option value="art">Ngh·ªá thu·∫≠t</option>
    </select>

    <label for="distance">B√°n k√≠nh t√¨m ki·∫øm:</label>
    <select id="distance">
      <div id="radius-description" style="margin-top: 10px; font-size: 14px; color: #555;">
      <p>Hi·ªÉn th·ªã c√°c ƒë·ªãa ƒëi·ªÉm n·∫±m trong b√°n k√≠nh <strong>theo ƒë∆∞·ªùng th·∫≥ng</strong> t·ª´ v·ªã tr√≠ hi·ªán t·∫°i c·ªßa b·∫°n.</p>
      <p><em>L∆∞u √Ω:</em> Qu√£ng ƒë∆∞·ªùng th·ª±c t·∫ø b·∫°n ph·∫£i ƒëi c√≥ th·ªÉ d√†i h∆°n do ƒë∆∞·ªùng ƒëi th·ª±c t·∫ø c√≥ th·ªÉ u·ªën l∆∞·ª£n ho·∫∑c v√≤ng l·∫°i.</p>
    </div>
      <option value="1" selected>1 km</option>
      <option value="3">3 km</option>
      <option value="5">5 km</option>
      <option value="10">10 km</option>
    </select>
    <div id="radius-description" style="margin-top: 10px; font-size: 14px; color: #555;">
      <p>Hi·ªÉn th·ªã c√°c ƒë·ªãa ƒëi·ªÉm n·∫±m trong b√°n k√≠nh <strong>theo ƒë∆∞·ªùng th·∫≥ng</strong> t·ª´ v·ªã tr√≠ hi·ªán t·∫°i c·ªßa b·∫°n.</p>
      <p><em>L∆∞u √Ω:</em> Qu√£ng ƒë∆∞·ªùng th·ª±c t·∫ø b·∫°n ph·∫£i ƒëi c√≥ th·ªÉ d√†i h∆°n do ƒë∆∞·ªùng ƒëi th·ª±c t·∫ø c√≥ th·ªÉ u·ªën l∆∞·ª£n ho·∫∑c v√≤ng l·∫°i.</p>
</div>
    <button onclick="startExperience()">Kh√°m ph√° ngay</button>
  </div>

  <div id="profile-box" style="display:none;">
    <h3>Th√¥ng tin ng∆∞·ªùi d√πng</h3>
    <p>Email: example@example.com</p>
  </div>

  <div id="location-info" style="display:none;">
    <h3>G·ª£i √Ω ƒë·ªãa ƒëi·ªÉm:</h3>
    <p id="status">ƒêang x√°c ƒë·ªãnh v·ªã tr√≠...</p>
    <ul id="places-list"></ul>
    <button id="back-button" onclick="goBack()">Quay l·∫°i</button>
    <button onclick="showFavorites()">üìå Xem y√™u th√≠ch</button>
    <button onclick="showQuizBox()">üß† ƒê·ªë vui</button>
  </div>

  <div id="map" style="display:none;"></div>
  <!-- M·ª•c 1: H·ªôp danh s√°ch y√™u th√≠ch -->
   <div id="favorites-box" class="section-box" style="display:none;">
  <h3>ƒê·ªãa ƒëi·ªÉm b·∫°n ƒë√£ y√™u th√≠ch</h3>
  <ul id="favorites-list"></ul>
  <button class="close-button" onclick="hideFavorites()">ƒê√≥ng</button>
</div>

  <!-- B·∫£ng tin s·ª± ki·ªán -->
  <div id="event-board" style="display:none;">
    <h3>S·ª± ki·ªán ƒëang di·ªÖn ra</h3>
    <ul id="event-list"></ul>
  </div>
  <!-- Trivia Quiz Box -->
  <div id="quiz-box" class="section-box" style="display: none;">
  <h3>üéØ ƒê·ªë vui v·ªÅ vƒÉn h√≥a & l·ªãch s·ª≠</h3>
  <div id="quiz-question"></div>
  <div id="quiz-options"></div>
<div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
  <button onclick="prevQuizQuestion()">‚¨ÖÔ∏è Quay l·∫°i</button>
  <button onclick="nextQuizQuestion()">C√¢u ti·∫øp theo ‚û°Ô∏è</button>
</div>
</div> <!-- K·∫øt th√∫c quiz box -->

</div> <!-- k·∫øt th√∫c #quiz-box -->

<!-- üëò Ph·∫ßn m√¥ h√¨nh 3D √°o d√†i truy·ªÅn th·ªëng -->
<div class="section-box">
  <h3>üß• Tr·∫£i nghi·ªám thi·∫øt k·∫ø √°o d√†i Nam truy·ªÅn th·ªëng</h3>

  <!-- üì± C·∫£nh b√°o cho thi·∫øt b·ªã di ƒë·ªông -->
  <p class="mobile-warning">üì± ƒê·ªÉ xem ƒë·∫ßy ƒë·ªß, h√£y xoay ngang ƒëi·ªán tho·∫°i.</p>

  <!-- üíª Iframe m√¥ h√¨nh 3D responsive -->
  <div style="width: 100%; aspect-ratio: 16 / 9; border-radius: 16px; overflow: hidden; box-shadow: 0 6px 20px rgba(0,0,0,0.1);">
    <iframe 
      id="IframE"
      src="https://fitting3d.com/tham-gia-thiet-ke-le-phuc-nam-truyen-thong"
      width="100%" 
      height="100%" 
      allowfullscreen 
      style="border: none; display: block;">
    </iframe>
  </div>
</div>



  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBRBMdgK9BXbXqzquW-O3o9gWroMtITj8",
      authDomain: "hackathon-cd084.firebaseapp.com",
      projectId: "hackathon-cd084",
      storageBucket: "hackathon-cd084.appspot.com",
      messagingSenderId: "328359261794",
      appId: "1:328359261794:web:0f336a85e228ccf4aa43b"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();

    window.login = async function () {
      try {
        const result = await auth.signInWithPopup(provider);
        const user = result.user;
        document.getElementById("login-btn").style.display = "none";
        document.getElementById("user-info").style.display = "block";
        document.getElementById("user-name").textContent = `Xin ch√†o, ${user.displayName || user.email}`;
      } catch (error) {
        console.error("L·ªói ƒëƒÉng nh·∫≠p:", error);
      }
    };

    window.logout = async function () {
      try {
        await auth.signOut();
        document.getElementById("login-btn").style.display = "inline-block";
        document.getElementById("user-info").style.display = "none";
      } catch (error) {
        console.error("L·ªói ƒëƒÉng xu·∫•t:", error);
      }
    };

    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById("login-btn").style.display = "none";
        document.getElementById("user-info").style.display = "block";
        document.getElementById("user-name").textContent = `Xin ch√†o, ${user.displayName || user.email}`;
      } else {
        document.getElementById("login-btn").style.display = "inline-block";
        document.getElementById("user-info").style.display = "none";
      }
    });
</script>
  <script>
    const statusElement = document.getElementById('status');
    const placesListElement = document.getElementById('places-list');
    const eventBoard = document.getElementById("event-board");
    const eventList = document.getElementById("event-list");
    const categorySelectElement = document.getElementById('category');
    const distanceSelectElement = document.getElementById('distance');
    const profileBoxElement = document.getElementById('profile-box');
    const locationInfoElement = document.getElementById('location-info');
    const questionBoxElement = document.getElementById('question-box');
    const mapDivElement = document.getElementById('map');

    let map;
    let userLatitude, userLongitude;
    let routingControl;

    function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat / 2) ** 2 +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) ** 2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    const culturalSites = {
  culture: [
    {
      name: "B·∫£o t√†ng Ch·ª©ng t√≠ch Chi·∫øn tranh",
      lat: 10.7798,
      lng: 106.6926,
      description: "Tr∆∞ng b√†y hi·ªán v·∫≠t v√† h√¨nh ·∫£nh v·ªÅ chi·∫øn tranh Vi·ªát Nam.",
      address: "28 V√µ VƒÉn T·∫ßn, Ph∆∞·ªùng V√µ Th·ªã S√°u, Qu·∫≠n¬†3, TP.HCM"
    },
    {
      name: "Nh√† h√°t Th√†nh ph·ªë",
      lat: 10.7769,
      lng: 106.7032,
      description: "C√¥ng tr√¨nh ki·∫øn tr√∫c c·ªï k√≠nh t·ªï ch·ª©c c√°c s·ª± ki·ªán ngh·ªá thu·∫≠t.",
      address: "7 C√¥ng Tr∆∞·ªùng Lam S∆°n, Ph∆∞·ªùng B·∫øn Ngh√©, Qu·∫≠n¬†1, TP.HCM",
      events: [
        {
          title: "ƒê√™m nh·∫°c c·ªï ƒëi·ªÉn",
          time: "01/08/2025 - 19:30",
          note: "Mi·ªÖn ph√≠ cho sinh vi√™n"
        },
        {
        title: "V·ªü k·ªãch d√¢n gian",
        time: "03/08/2025 - 20:00",
        note: "Ph·ª• ƒë·ªÅ ti·∫øng Anh" }
      ],
    }
  ],
  history: [
    {
      name: "Dinh ƒê·ªôc L·∫≠p",
      lat: 10.7772,
      lng: 106.6958,
      description: "Bi·ªÉu t∆∞·ª£ng l·ªãch s·ª≠ c·ªßa S√†i G√≤n, n∆°i k·∫øt th√∫c chi·∫øn tranh nƒÉm 1975.",
      address: "135 Nam K·ª≥ Kh·ªüi Nghƒ©a, Ph∆∞·ªùng B·∫øn Th√†nh, Qu·∫≠n¬†1, TP.HCM",
      events: [
    {
      title: "Tri·ªÉn l√£m t√†i li·ªáu 30/4",
      time: "05/08/2025 - 09:00",
      note: "Tr√¨nh chi·∫øu phim t∆∞ li·ªáu l·ªãch s·ª≠"
    }
  ]
    },
    {
      name: "B·∫£o t√†ng H·ªì Ch√≠ Minh",
      lat: 10.7875,
      lng: 106.7032,
      description: "Gi·ªõi thi·ªáu cu·ªôc ƒë·ªùi v√† s·ª± nghi·ªáp c·ªßa Ch·ªß t·ªãch H·ªì Ch√≠ Minh.", 
      address: "1 Nguy·ªÖn T·∫•t Th√†nh, Ph∆∞·ªùng 12, Qu·∫≠n¬†4, TP.HCM",
      events: [
    {
      title: "Tri·ªÉn l√£m t√†i li·ªáu 30/4",
      time: "05/08/2025 - 09:00",
      note: "Tr√¨nh chi·∫øu phim t∆∞ li·ªáu l·ªãch s·ª≠"
    }
  ]
    }
  ],
  art: [
    {
      name: "B·∫£o t√†ng M·ªπ thu·∫≠t TP.HCM",
      lat: 10.7715,
      lng: 106.7001,
      description: "N∆°i tr∆∞ng b√†y c√°c t√°c ph·∫©m m·ªπ thu·∫≠t c·ªï v√† hi·ªán ƒë·∫°i.",
      address: "97A Ph√≥ ƒê·ª©c Ch√≠nh, Ph∆∞·ªùng Nguy·ªÖn Th√°i B√¨nh, Qu·∫≠n 1, TP.HCM"
    },
    {
      name: "Artinus 3D Art Museum",
      lat: 10.7402,
      lng: 106.7051,
      description: "B·∫£o t√†ng tranh 3D t∆∞∆°ng t√°c ƒë·ªôc ƒë√°o t·∫°i TP.HCM.",
      address: "2‚Äë4 ƒê∆∞·ªùng s·ªë¬†9, Khu ƒë√¥ th·ªã Him Lam, Ph∆∞·ªùng T√¢n H∆∞ng, Qu·∫≠n¬†7, TP.HCM",
      events: [
    {
      title: "Tri·ªÉn l√£m t√†i li·ªáu 30/4",
      time: "05/08/2025 - 09:00",
      note: "Tr√¨nh chi·∫øu phim t∆∞ li·ªáu l·ªãch s·ª≠"
    }
  ]
    }
  ]
};

    new Choices('#category', { searchEnabled: false, itemSelectText: '', shouldSort: false });
    new Choices('#distance', { searchEnabled: false, itemSelectText: '', shouldSort: false });
    async function getAddress(lat, lng) {
  try {
    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
    const data = await response.json();
    return data.display_name || "Kh√¥ng t√¨m th·∫•y ƒë·ªãa ch·ªâ.";
  } catch (error) {
    return "Kh√¥ng th·ªÉ l·∫•y ƒë·ªãa ch·ªâ.";
  }
}

    function startExperience() {
      questionBoxElement.style.display = 'none';
      profileBoxElement.style.display = 'block';
      locationInfoElement.style.display = 'block';
      mapDivElement.style.display = 'block';

      const selectedCategory = categorySelectElement.value;
      const selectedSites = culturalSites[selectedCategory] || [];
      const selectedDistance = parseFloat(distanceSelectElement.value);

      if (!navigator.geolocation) {
        statusElement.textContent = "Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã.";
        return;
      }

      statusElement.textContent = "ƒêang l·∫•y v·ªã tr√≠ th·ª±c t·∫ø...";

      navigator.geolocation.getCurrentPosition(
        position => {
          userLatitude = position.coords.latitude;
          userLongitude = position.coords.longitude;

          statusElement.textContent = `V·ªã tr√≠ c·ªßa b·∫°n: (${userLatitude.toFixed(4)}, ${userLongitude.toFixed(4)}) ‚Äî hi·ªÉn th·ªã c√°c ƒë·ªãa ƒëi·ªÉm c√°ch b·∫°n trong b√°n k√≠nh ${selectedDistance} km`;
          const nearbySites = selectedSites.filter(site => {
              const distance = parseFloat(getDistanceFromLatLonInKm(userLatitude, userLongitude, site.lat, site.lng).toFixed(2));
              console.log(`üèõÔ∏è ${site.name} c√°ch ${distance} km`);
              return distance <= selectedDistance;
            });

          if (map) {
            map.eachLayer(layer => map.removeLayer(layer));
            map.remove();
            map = null;
          }

          map = L.map('map').setView([userLatitude, userLongitude], 14);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
          }).addTo(map);

          L.marker([userLatitude, userLongitude]).addTo(map).bindPopup('V·ªã tr√≠ c·ªßa b·∫°n').openPopup();

          if (nearbySites.length === 0) {
            placesListElement.innerHTML = `<li>Kh√¥ng c√≥ ƒë·ªãa ƒëi·ªÉm n√†o trong b√°n k√≠nh ${selectedDistance} km.</li>`;
            return;
          }

          placesListElement.innerHTML = nearbySites.map(site => {
            updateFavoriteIcons();
            const distance = parseFloat(getDistanceFromLatLonInKm(userLatitude, userLongitude, site.lat, site.lng).toFixed(2));
            return `<li>
            <strong>${site.name}</strong>
            <button class="favorite-btn" data-site="${site.name}" onclick="toggleFavorite('${site.name}')">ü§ç</button><br>
            <a target="_blank" href="https://maps.google.com/?q=${site.lat},${site.lng}">Xem b·∫£n ƒë·ªì</a><br>
            <button onclick="showRoute(${site.lat}, ${site.lng}, 'distance-${site.name.replace(/\s+/g, '-')}')">Ch·ªâ ƒë∆∞·ªùng</button
            </li>`;
        }).join('');
          nearbySites.forEach(async site => {
            const address = site.address || await getAddress(site.lat, site.lng);
            const categoryName = categorySelectElement.options[categorySelectElement.selectedIndex].text;
            const popupContent = `
              <strong>${site.name}</strong><br>
              <em>ƒê·ªãa ch·ªâ:</em> ${address}<br>
              <em>Lo·∫°i:</em> ${categoryName}<br>
              <em>M√¥ t·∫£:</em> ${site.description || "Kh√¥ng c√≥ m√¥ t·∫£."}
          `;
            L.marker([site.lat, site.lng]).addTo(map).bindPopup(popupContent);
});
eventList.innerHTML = "";
  nearbySites.forEach(site => {
    if (site.events && site.events.length > 0) {
      site.events.forEach(event => {
        const li = document.createElement("li");
        li.innerHTML = `
        <strong>${event.title}</strong> t·∫°i <em>${site.name}</em><br>
        ‚è∞ ${event.time}<br>
        üìç ${event.note || ""}
      `;
        eventList.appendChild(li);
      });
    }
  });
    if (eventList.childElementCount > 0) {
      eventBoard.style.display = "block";
      } else {
        eventBoard.style.display = "none";
      }


        },
        error => {
          statusElement.textContent = "Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠. Vui l√≤ng b·∫≠t ƒë·ªãnh v·ªã.";
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    }

    function showRoute(destinationLatitude, destinationLongitude) {
      if (!map || !userLatitude || !userLongitude) return;
      if (routingControl) map.removeControl(routingControl);

      routingControl = L.Routing.control({
        waypoints: [
          L.latLng(userLatitude, userLongitude),
          L.latLng(destinationLatitude, destinationLongitude)
        ],
        routeWhileDragging: false,
        showAlternatives: false,
        createMarker: () => null
      }).addTo(map);
    }

    function goBack() {
      questionBoxElement.style.display = 'block';
      profileBoxElement.style.display = 'none';
      locationInfoElement.style.display = 'none';
      mapDivElement.style.display = 'none';
      placesListElement.innerHTML = '';
      statusElement.textContent = 'ƒêang x√°c ƒë·ªãnh v·ªã tr√≠...';
      eventBoard.style.display = 'none';
      eventList.innerHTML = '';

      if (map) {
        map.eachLayer(layer => map.removeLayer(layer));
        map.remove();
        map = null;
      }
      if (routingControl) {
        routingControl.spliceWaypoints(0, 2);
        routingControl = null;
      }
    }

    function toggleDarkMode() {
      document.body.classList.add('transitioning');
      setTimeout(() => {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        document.getElementById('darkmode-toggle').textContent =
          document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
      }, 50);
      setTimeout(() => {
        document.body.classList.remove('transitioning');
      }, 350);
    }

    window.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
        document.body.classList.add('dark-mode');
        document.getElementById('darkmode-toggle').textContent = '‚òÄÔ∏è';
      }
      culturalSites.culture[1].events = [
  {
    title: "ƒê√™m nh·∫°c c·ªï ƒëi·ªÉn",
    time: "01/08/2025 - 19:30",
    note: "Mi·ªÖn ph√≠ cho sinh vi√™n"
  },
  {
    title: "V·ªü k·ªãch d√¢n gian",
    time: "03/08/2025 - 20:00",
    note: "Ph·ª• ƒë·ªÅ ti·∫øng Anh"
  }
];
    });
    function toggleFavorite(siteName) {
  let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
  if (favorites.includes(siteName)) {
    favorites = favorites.filter(item => item !== siteName);
  } else {
    favorites.push(siteName);
  }
  localStorage.setItem("favorites", JSON.stringify(favorites));
  updateFavoriteIcons();
}

function updateFavoriteIcons() {
  const favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
  document.querySelectorAll('.favorite-btn').forEach(btn => {
    const siteName = btn.getAttribute('data-site');
    if (favorites.includes(siteName)) {
      btn.classList.add('saved');
      btn.textContent = '‚ù§Ô∏è';
    } else {
      btn.classList.remove('saved');
      btn.textContent = 'ü§ç';
    }
  });
}
function showFavorites() {
  const favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
  const allSites = [...culturalSites.culture, ...culturalSites.history, ...culturalSites.art];
  const favoriteSites = allSites.filter(site => favorites.includes(site.name));
  const list = document.getElementById("favorites-list");
  const box = document.getElementById("favorites-box");

  if (favoriteSites.length === 0) {
    list.innerHTML = "<li>Ch∆∞a c√≥ ƒë·ªãa ƒëi·ªÉm n√†o ƒë∆∞·ª£c y√™u th√≠ch.</li>";
  } else {
    list.innerHTML = favoriteSites.map(site => `
      <li>
        <strong>${site.name}</strong><br>
        üìç ${site.address || "Kh√¥ng r√µ ƒë·ªãa ch·ªâ"}<br>
        <button onclick="showRoute(${site.lat}, ${site.lng})">ƒê∆∞·ªùng ƒëi</button>
      </li>
    `).join('');
  }

  box.style.display = "block"; // üëà hi·ªÉn th·ªã tr∆∞·ªõc ƒë·ªÉ k√≠ch ho·∫°t hi·ªáu ·ª©ng
  setTimeout(() => {
    box.classList.add("active"); // üëà th√™m class sau m·ªôt ch√∫t (an to√†n)
  }, 10);
}
function hideFavorites() {
  const box = document.getElementById("favorites-box");
  box.classList.remove("active"); // üëà k√≠ch ho·∫°t hi·ªáu ·ª©ng ·∫©n
  setTimeout(() => {
    box.style.display = "none"; // üëà sau 0.4s th√¨ ·∫©n h·∫≥n (kh·ªõp v·ªõi CSS transition)
  }, 400);
}
document.querySelector('#favorites-box .close-button').addEventListener('click', () => {
    const favoritesBox = document.getElementById('favorites-box');
    favoritesBox.classList.remove('active');

    // Hi·ªán l·∫°i ph·∫ßn l·ªçc ƒë·ªãa ƒëi·ªÉm g·ªëc
    document.querySelector('.section-box').style.display = 'block';
  });
  document.addEventListener('click', function (event) {
  const box = document.getElementById('favorites-box');
  if (!box.contains(event.target) && box.classList.contains('active')) {
    hideFavorites();
  }
});
const quizData = [
  {
    question: "Dinh ƒê·ªôc L·∫≠p l√† bi·ªÉu t∆∞·ª£ng l·ªãch s·ª≠ k·∫øt th√∫c chi·∫øn tranh Vi·ªát Nam v√†o nƒÉm n√†o?",
    options: ["1973", "1974", "1975", "1976"],
    answer: "1975"
  },
  {
    question: "B·∫£o t√†ng n√†o tr∆∞ng b√†y tranh 3D t∆∞∆°ng t√°c t·∫°i TP.HCM?",
    options: ["B·∫£o t√†ng Ch·ª©ng t√≠ch", "Artinus 3D", "M·ªπ thu·∫≠t TP.HCM", "Dinh ƒê·ªôc L·∫≠p"],
    answer: "Artinus 3D"
  }
];

let currentQuiz = 0;

function showQuizBox() {
  document.getElementById("quiz-box").style.display = "block";
  renderQuizQuestion();
}

function renderQuizQuestion() {
  const q = quizData[currentQuiz];
  const quizQ = document.getElementById("quiz-question");
  const quizOpts = document.getElementById("quiz-options");

  quizQ.innerHTML = `<p><strong>${q.question}</strong></p>`;
  quizOpts.innerHTML = q.options.map(option => `
    <button onclick="checkAnswer('${option}')">${option}</button>
  `).join('');

  // ·∫®n n√∫t "Quay l·∫°i" n·∫øu ƒëang ·ªü c√¢u ƒë·∫ßu
  const backBtn = document.querySelector('button[onclick="prevQuizQuestion()"]');
  if (backBtn) {
    backBtn.style.display = currentQuiz === 0 ? "none" : "inline-block";
  }
}

function checkAnswer(selected) {
  const correct = quizData[currentQuiz].answer;
  if (selected === correct) {
    alert("‚úÖ Ch√≠nh x√°c!");
  } else {
    alert("‚ùå Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√†: " + correct);
  }
}

function nextQuizQuestion() {
  currentQuiz = (currentQuiz + 1) % quizData.length;
  renderQuizQuestion();
}
function prevQuizQuestion() {
  if (currentQuiz > 0) {
    currentQuiz--;
    renderQuizQuestion();
  } else {
    alert("‚õî B·∫°n ƒëang ·ªü c√¢u ƒë·∫ßu ti√™n.");
  }
}

  </script>
</body>
</html>
